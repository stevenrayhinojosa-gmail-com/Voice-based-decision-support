{% extends "layout.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h1 class="mb-3">Behavioral Protocols</h1>
        <p class="lead">Create and manage structured decision protocols for behavioral interventions</p>
    </div>
</div>

<div class="row mb-4">
    <!-- Create Protocol Card -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-plus-circle me-2"></i> Create New Protocol</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('add_protocol') }}">
                    {{ form.hidden_tag() }}
                    
                    <div class="mb-3">
                        <label for="name" class="form-label">{{ form.name.label }}</label>
                        {{ form.name(class="form-control" + (" is-invalid" if form.name.errors else "")) }}
                        {% for error in form.name.errors %}
                        <div class="invalid-feedback">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="category" class="form-label">{{ form.category.label }}</label>
                        {{ form.category(class="form-control" + (" is-invalid" if form.category.errors else "")) }}
                        {% for error in form.category.errors %}
                        <div class="invalid-feedback">{{ error }}</div>
                        {% endfor %}
                        <div class="form-text">E.g., "Education", "Clinical", "Workplace"</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label">{{ form.description.label }}</label>
                        {{ form.description(class="form-control" + (" is-invalid" if form.description.errors else ""), rows=4) }}
                        {% for error in form.description.errors %}
                        <div class="invalid-feedback">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    {{ form.submit(class="btn btn-primary w-100") }}
                </form>
            </div>
        </div>
    </div>
    
    <!-- Protocol Overview Card -->
    <div class="col-md-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-sitemap me-2"></i> Your Protocols</h5>
            </div>
            <div class="card-body">
                {% if protocols %}
                <div class="row row-cols-1 row-cols-md-2 g-4">
                    {% for protocol in protocols %}
                    <div class="col">
                        <div class="card h-100 protocol-card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">{{ protocol.name }}</h5>
                                {% if protocol.category %}
                                <span class="badge bg-secondary">{{ protocol.category }}</span>
                                {% endif %}
                            </div>
                            <div class="card-body">
                                {% if protocol.description %}
                                <p class="card-text">{{ protocol.description[:100] }}{% if protocol.description|length > 100 %}...{% endif %}</p>
                                {% else %}
                                <p class="card-text text-muted"><i>No description provided</i></p>
                                {% endif %}
                                
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">Created: {{ protocol.created_at.strftime('%Y-%m-%d') }}</small>
                                    
                                    {% set decision_point_count = protocol.decision_points|length %}
                                    <span class="badge bg-primary">
                                        {{ decision_point_count }} Decision Point{{ 's' if decision_point_count != 1 else '' }}
                                    </span>
                                </div>
                            </div>
                            <div class="card-footer bg-transparent text-center">
                                <a href="{{ url_for('protocol_detail', protocol_id=protocol.id) }}" class="btn btn-outline-primary">
                                    <i class="fas fa-edit me-1"></i> Edit Protocol
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> You haven't created any protocols yet.
                    Use the form on the left to create your first protocol.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Protocol Usage Guide -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i> How to Create Effective Protocols</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 bg-light">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-lightbulb text-warning me-2"></i> Step 1: Define Purpose</h5>
                                <p class="card-text">
                                    Clearly identify the behavioral scenario and objective of your protocol. 
                                    What problem are you trying to solve or what decision process are you trying to standardize?
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 bg-light">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-project-diagram text-primary me-2"></i> Step 2: Map Decision Points</h5>
                                <p class="card-text">
                                    Identify the key questions or assessment points in your decision process.
                                    Structure them in a logical order, from broad to specific.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 bg-light">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-route text-success me-2"></i> Step 3: Define Pathways</h5>
                                <p class="card-text">
                                    For each decision point, create options that lead to either further decision points
                                    or terminal recommendations based on the selected pathway.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
